import { useFieldArray, useFormContext } from "react-hook-form";
import { useTranslation } from "react-i18next";
import { FormInput } from "components";
import { IEditedVaultDescription } from "../types";
import VulnerabilitySeverityForm from "./VulnerabilitySeverityForm/VulnerabilitySeverityForm";

export function VulnerabilitySeveritiesList() {
  const { t } = useTranslation();
  const { control, register, getFieldState, formState } = useFormContext<IEditedVaultDescription>();
  const { fields: severities, append, remove } = useFieldArray({ control, name: "vulnerability-severities-spec.severities" });

  return (
    <>
      <div>
        <FormInput
          {...register(`vulnerability-severities-spec.indexArray`)}
          isDirty={getFieldState(`vulnerability-severities-spec.indexArray`, formState).isDirty}
          label={t("VaultEditor.severities-index-array")}
          colorable
          placeholder={t("VaultEditor.severities-index-array-placeholder")}
        />
      </div>

      {severities.map((severity, index) => (
        <VulnerabilitySeverityForm key={severity.id} index={index} append={append} remove={remove} />
      ))}
    </>
  );
}
